---
title: "Data analysis for benchmarking combinatorial solvers"
output:
  pdf_document: default
  html_notebook: default
---

This document is meant as cheatsheet for how to construct common plots used in
combinatorial solving. You can execut '?command' to open the help for a command in RStudio.
For exmaple, '?pivot_wider'

```{r setup, include=FALSE}

library(dplyr)
library(tidyr)
library(ggplot2)
library(xtable)

library(ggthemes)
theme_set(theme_light())
```

#Load Data

```{r}
data <- read.csv("data.csv", header = TRUE)

# display the names of columns in the data frame
names(data)
# just using the data frame as command will display it
data

data %>% filter(status != "OK")
```

#Tabel

Make a table with timeouts.

```{r}
table <- data %>%
  group_by(solver, family) %>%
  summarise(solved = sum(status == "OK")) %>%
  pivot_wider(names_from = solver, values_from = solved)

table

print(xtable(table, type = "latex"), file = "tabel.tex")
```

#Cummulative Plot

```{r}
df <- data %>%
  arrange(solver, time) %>%
  group_by(solver) %>%
  mutate(nsolved = rank(time)) %>%
  select(solver, time, nsolved)

ggplot(df, aes(x = time, y = nsolved, color = solver, shape = solver)) +
  geom_point() +
  geom_line()
```
# Scatter Plot

```{r}
timeout = 5000

df <- data %>%
  mutate(time = ifelse(status == "timeout", 2 * timeout, time)) %>%
  select(family,instance,solver,time) %>% 
  pivot_wider(names_from = solver, values_from = time)

ggplot(df, aes(x = SolverB1, y = SolverB2, color = family)) +
  geom_point() +
        scale_x_log10() +
        scale_y_log10() +
        coord_fixed(ratio = 1) +
        geom_vline(xintercept = timeout, linetype="dashed") +
        geom_hline(yintercept = timeout, linetype="dashed") +
        geom_abline(slope = 1, intercept = 0, linetype="dashed")

ggplot(df, aes(x = SolverA, y = SolverB2, color = family)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  coord_fixed(ratio = 1) +
  geom_vline(xintercept = timeout, linetype="dashed") +
  geom_hline(yintercept = timeout, linetype="dashed") +
  geom_abline(slope = 1, intercept = 0, linetype="dashed")
```
#Scaling Plot

```{r}
ggplot(data %>% filter(family == "benchmarkC", solver == "SolverA"),
       aes(x = scaling, y = time, color = solver)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  geom_smooth(method='lm')

lm(log10(time) ~ log10(scaling), data = data %>%
     filter(family == "benchmarkB", solver == "SolverB1"))

```



# Labels and Captions

```{r}
timeout = 5000

df <- data %>%
  mutate(time = ifelse(status == "timeout", 2 * timeout, time)) %>%
  select(family,instance,solver,time) %>% 
  pivot_wider(names_from = solver, values_from = time)

# let us also use shapes this time
ggplot(df, aes(x = SolverA, y = SolverB2, color = family, shape = family)) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  coord_fixed(ratio = 1) +
  geom_vline(xintercept = timeout, linetype="dashed") +
  geom_hline(yintercept = timeout, linetype="dashed") +
  geom_abline(slope = 1, intercept = 0, linetype="dashed") +
  
  ylab("SolverB2 (time in s)") + 
  xlab("SolverA (time in s)") + 
  # Note that we need to redefine the label for color AND shape
  labs(color = "Benchmark Family", shape = "Benchmark Family", title = "A fancy plot")
  
```


#Boxplot

```{r}
df <- data %>%
  select(family, instance, solver, time) %>%
  pivot_wider(names_from = solver, values_from = time) %>%
  mutate(speedup = SolverB1/SolverB2)

ggplot(df, aes(x = family, y = speedup)) +
  scale_y_log10() +
  geom_boxplot()
```